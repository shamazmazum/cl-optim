<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
  More examples &ndash; cl-optim
</title>
    <link rel="stylesheet" href="static/style.css"/>
    
  <link rel="stylesheet" href="static/highlight.css"/>
  <script src="static/highlight.js"></script>
  <style>
   /* Highlight the current top-level TOC item, and hide the TOC of all other items */

   .toc a[data-node="more-examples"] {
       /*color: #AD3108;*/
   }

   .toc ol {
       display: none;
   }

   .toc li a[data-node="more-examples"] {
       font-weight: bold;
   }

   .toc li a[data-node="more-examples"] + ol {
       display: block;
   }

   .toc li a[data-node="more-examples"] + ol li {
       margin-left: 10px;
   }
  </style>

  </head>
  <body>
    
  <h1 class="doc-title">cl-optim</h1>
  <article id="article" data-section="more-examples">
    <aside>
      <ol class="toc"><li><a href="index.html" data-node="index">Manual</a><ol><li><a href="index.html#gradient-based-algorithms" data-node="gradient-based-algorithms">Gradient-based algorithms</a></li></ol></li><li><a href="api.html" data-node="api">API</a></li><li><a href="tips.html" data-node="tips">Tips</a></li><li><a href="more-examples.html" data-node="more-examples">More examples</a><ol><li><a href="more-examples.html#solving-a-system-of-linear-equations" data-node="solving-a-system-of-linear-equations">Solving a system of linear equations</a></li></ol></li></ol>
    </aside>
    <main class="codex-section">
      <header>
        <h2 class="section-title">More examples</h2>
      </header>
      <div class="content">
        <p>   </p><h1 id="solving-a-system-of-linear-equations">Solving a system of linear equations</h1><p>      Consider this system of linear equations:
      </p><pre><code class=NIL> x + 2y +  z + 3w = 18
2x +  y +  z +  w = 12
 x + 3y + 2z + 4w = 28
 x + 5y + z  +  w = 23
      </code></pre><p>
      or <code>Au = v</code> in matrix form where <code>v</code> is a column containing the right
      hand of the equations and <code>A</code> is a 4x4 matrix containing coefficients of
      the equations. The solution <code>u</code> minimizes the cost function
      <code>Σ<sub>k</sub>(Au - v)<sub>k</sub><sup>2</sup></code>. The code for the cost function is
      the following:
      </p><pre><code class="lisp">(defpackage linear-system
  (:use #:cl)
  #.(cl-forward-diff:shadowing-import-math)
  (:export #:linear-system-cost))
(in-package :linear-system)

(defun matrix-vector-mul (mat vec)
  &quot;Multiply a matrix MAT by a column VEC&quot;
  (mapcar
   (lambda (row)
     (reduce #'+ (mapcar #'* row vec)))
   mat))

(defun linear-system-cost (mat v u)
  &quot;Calculate a cost function for a system of linear equations MAT*X=V at the
  point X=U&quot;
  (let ((val (matrix-vector-mul mat u)))
    (reduce
     #'+ (mapcar
          (lambda (v v%)
            (expt (- v v%) 2))
          v val))))
      </code></pre><p>      Now evaluate the following code in the REPL:
      </p><pre><code class="lisp">(cl-optim:nag
 (alexandria:curry #'linear-system:linear-system-cost
                   '((1 2 1 3)
                     (2 1 1 1)
                     (1 3 2 4)
                     (1 5 1 1))
                   '(18 12 28 23))
 '(0.0 0.0 0.0 0.0)
 :β1 0.99)
      </code></pre><p>      The answer is <code>(1.000277 3.0000377 4.999421 2.000142)</code> which is
      calculated in 1677 steps.
   </p><p>
</p>
      </div>
    </main>
  </article>
  <footer>
    <div class="info">
      Created with <a href="https://github.com/CommonDoc/codex">Codex</a>.
    </div>
  </footer>
  <script>
   HighlightLisp.highlight_auto();
  </script>

  </body>
</html>
